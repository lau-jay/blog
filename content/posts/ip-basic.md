+++
title = "IP层"
date = 2020-07-13T21:26:30+08:00
images = []
tags = ["tcp/ip"]
categories = ["net"]
draft = true

+++

IP负责寻址相当于路线图. 数据链路相当于交通工具.

不论更换多少种交通工具(MAC地址会改变), 你的目的地(目的IP)和出发地(源IP)不会更改.

### IP地址的格式与分类

IP地址在计算机内自然是二进制的, 但是为了人类可读, 采用了点分十进制的方式.

以下为IPv4(32位二进制)

```
二进制: 11000000 10101000 00000001 00000001
十进制: 192          168     1         1
点分十进制 192.       168.    1.        1
```

根据位数,那么可以确定IP地址最多只能有 2^32 = 4292967296, 也就是不到43亿个不同的地址.

在今天看来当然不够用,但是互联网的上古时代, 43亿是天文数字,太过充裕了.

于是计算机科学家设计了如下的分类方式:

#### IP分类

```
A类(分类号0):
    [1位分类号][7位网络号][24位主机号]
B类(分类号10:
    [2位分类号][14位网络号][16位主机号]
C类(分类号110):
    [3位分类号][21位网络号][8位主机号]
D类(分类号1110):
    [4位分类号][28组播地址]
E类(分类号11110):
    [5位分类号][27位留待后用]
```

从位数那么可以知道

```
A类: 0.0.0.0~127.255.255.255   主机位24位,共16777216(去掉首尾) 也就是16777214
B类: 128.0.0.0~191.255.255.255 主机位16位,共65536(去掉首尾)也就是65534
C类: 192.0.0.0~223.255.255.255 主机位8, 256(去掉首尾) 也就是254
```

去掉首尾是因为,主机号全1和全0是特殊的, 全1(也就是主机号位为255)用来广播, 全0指定某个网络

广播是用于在同一个链路种互相连接的主机之间发送数据包.广播分为两类..不展开

D类用于多播, 多播可以穿透路由,常用语跨网段发送包.

#### 无分类地址CIDR

因为IP分类存在许多缺点, 后来产生了CIDR, 将32位分为网络号和主机号

形式为 a.b.c.d/x, x表示前n位是网络号. 很显然x in [0, 32]

`10.100.122.2/24`, 前24位表示网络号, 剩余的8位是主机号

另一种就是子网掩码的表示法, IP地址与子网掩码and操作,得到的就是网络号

同时,子网掩码可以用来划分子网, 可以将掩码掩去的主机号再细分,为子网网络号和子网主机地址.

比如IP `192.168.1.0` 子网掩码为`255.255.255.192` , 对比C类地址,会发现主机号少了2位, 

也就是说这个地址分为四个子网:

192.168.1. 00 

192.168.1. 01

192.168.1.10

 192.168.1.11

### IP分片与重组

MTU是数据链路层的术语,其含义是最大传输单元, IP层会在IP数据报大于MTU的时候进行IP分片, IP的分片路由不重组, 只由目的

地址的IP层重组. 由于IP数据包丢失会导致整个IP数据报作废,所以应该避免在IP层分片,为此. TCP引入了MSS. UDP由于没有MSS.

只能在应用层控制不要大于MTU的数据报文.

### IPv6

由于32位的IPv4早在2011年就分完了. 所以提出了IPv6 ,IPv6的地址是128位的, 这个是个天文数字了. 但是其和IPv4 不兼容.所以普及缓慢, 因为网络运营商需要升级设备, 这是一大笔成本.





